
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Building an advanced api option parser for grape - Aurélien Hervé</title>
  <meta name="author" content="A. Hervé">

  
  <meta name="description" content="">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aurelien-herve.com/blog/2014/10/14/advanced-api-option-parser-for-grape">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Aurélien Hervé" type="application/atom+xml">
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28822787-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Aurélien Hervé</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/publications">Conferences & publications</a></li> 
  <!-- <li><a href="/blog/archives">Archives</a></li> -->
  <li><a href="#" onclick="alert('feel free to drop me a mail ! \n mail @ aurelien-herve.com');">contact</a></li>
  <li><a href="/cv">CV</a></li>
  <li><a href="/hire-me/en">Hire me!</a></li>
</ul>




        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:aurelien-herve.com" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Building an Advanced Api Option Parser for Grape</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-14T09:52:35+02:00" pubdate data-updated="true">Oct 14<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>When building an elaborated api, you might want your users to pass parameters in order to describe exactly what response they expect from the api.</p>

<p>For instance, it is useful to be able to do something as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">users</span><span class="p">:</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span>  <span class="c1"># =&gt; find a user and get his name only</span>
</span><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">users</span><span class="p">:</span> <span class="p">{</span><span class="ss">email</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span> <span class="c1"># =&gt; find a user and get both his name and email</span>
</span><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">users</span><span class="p">:</span> <span class="p">{</span><span class="ss">email</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">posts</span><span class="p">:</span> <span class="kp">true</span><span class="p">},</span> <span class="ss">post</span><span class="p">:</span> <span class="p">{</span><span class="ss">title</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span> <span class="c1"># =&gt; find a user and get his name, his email, and all his posts titles</span>
</span></code></pre></td></tr></table></div></figure>


<p>instead of presenting all of the model&rsquo;s attributes at each api call.</p>

<!-- more -->


<h2>1. Basic grape/entity usage</h2>

<p>At <a href="http://shapter.com">Shapter</a> we use the awesome <a href="https://github.com/intridea/grape">Grape</a> api framework, along with <a href="https://github.com/intridea/grape-entity">grape-entity</a>.</p>

<p>For instance, let&rsquo;s say we wan to build a route that finds and present a user:</p>

<figure class='code'><figcaption><span>AwesomeApp/entities/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">AwesomeApp</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Entities</span>
</span><span class='line'>    <span class="k">module</span> <span class="nn">User</span> <span class="o">&lt;</span> <span class="ss">Grape</span><span class="p">:</span><span class="ss">:Entity</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:id</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:name</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:email</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>api/users.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">namespace</span> <span class="ss">:users</span> <span class="k">do</span>  <span class="c1"># prefix routes with &#39;users/&#39;</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s2">&quot;get a user&quot;</span> <span class="c1"># describe your method for the documentation</span>
</span><span class='line'>  <span class="n">params</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">requires</span> <span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="ss">desc</span><span class="p">:</span> <span class="s2">&quot;id of the user&quot;</span> <span class="c1"># requires a user_id to be passed</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;:user_id&#39;</span> <span class="k">do</span>  <span class="c1"># this will get the params[:user_id] from the url</span>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span><span class="p">)</span> <span class="o">||</span> <span class="n">error!</span><span class="p">(</span><span class="s1">&#39;user not found&#39;</span><span class="p">,</span><span class="mi">404</span><span class="p">)</span> <span class="c1"># find the user</span>
</span><span class='line'>    <span class="n">present</span> <span class="n">user</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">AwesomeApp</span><span class="p">:</span><span class="ss">:Entities</span><span class="o">::</span><span class="no">User</span>  <span class="c1"># use grape-entity to present the model</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This setup will create a <code>/users/:id/</code> route that returns a user in a hash of the form <code>{id: 123, name: "John Doe", email: "foo@bar.com"}</code></p>

<h2>2. With a bit of optimization</h2>

<p>If your api is to grow more complex, the number of exposed attributes can quickly increase, and with it the size of the json hash the api sends. However you do not want all of the <code>User</code>&rsquo;s attributes to be return each time you call your route.</p>

<p>To avoid unnecessary overload, you can build an option parser that allow the api-user to describe the type of response he&rsquo;s expecting.</p>

<h4>Add conditional exposures to your entity</h4>

<p>First we tell entity to expose attributes only when asked to:</p>

<figure class='code'><figcaption><span>AwesomeApp/entities/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">AwesomeApp</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Entities</span>
</span><span class='line'>    <span class="k">module</span> <span class="nn">User</span> <span class="o">&lt;</span> <span class="ss">Grape</span><span class="p">:</span><span class="ss">:Entity</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:id</span> <span class="c1"># always expose the id</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:name</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="p">}</span>   <span class="c1">#conditional exposure</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:email</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">][</span><span class="ss">:email</span><span class="o">]</span><span class="p">}</span> <span class="c1">#conditional exposure</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>create a helper to parse the options</h4>

<p>Next, we create a helper that will read <code>params</code> to avoid tedious code duplication:</p>

<figure class='code'><figcaption><span>AwesomeApp/Helpers/OptionsHelper</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># white-list params[:entities][&lt;some_model&gt;], and create empty hashes if needed:</span>
</span><span class='line'><span class="k">def</span> <span class="nf">entity_options</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;user&quot;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:entities</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">]</span> <span class="k">rescue</span> <span class="kp">nil</span><span class="p">)</span> <span class="o">||</span> <span class="p">{},</span>
</span><span class='line'>    <span class="s2">&quot;post&quot;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:entities</span><span class="o">][</span><span class="s2">&quot;post&quot;</span><span class="o">]</span> <span class="k">rescue</span> <span class="kp">nil</span><span class="p">)</span> <span class="o">||</span> <span class="p">{},</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>pass the options hash to Grape::Entity</h4>

<p>Finally, we need to connect everything in the api method description:</p>

<figure class='code'><figcaption><span>api/users.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">helpers</span> <span class="ss">AwesomeApp</span><span class="p">:</span><span class="ss">:Helpers</span><span class="o">::</span><span class="no">OptionsHelper</span> <span class="c1">#include the helper</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:users</span> <span class="k">do</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="n">present</span> <span class="n">user</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">AwesomeApp</span><span class="p">:</span><span class="ss">:Entities</span><span class="o">::</span><span class="no">User</span><span class="p">,</span> <span class="n">entity_options</span><span class="p">:</span> <span class="n">entity_options</span> <span class="c1">#simple call entity_options</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Profit</h4>

<p>And <em>Voila</em> !</p>

<p>Now your api-users can efficiently call the routes to get the attributes they want:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">users</span><span class="p">:</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span>  <span class="c1"># =&gt; find a user and get his name only</span>
</span><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="p">{</span><span class="ss">users</span><span class="p">:</span> <span class="p">{</span><span class="ss">email</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span> <span class="c1"># =&gt; find a user and get both his name and email</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Bonus: it works with nested model exposures !</h3>

<p>Note that this system supports nested models exposures. For instance, if you want to get a user, and a list of his post ids and titles, then the following will work like a charm:</p>

<figure class='code'><figcaption><span>AwesomeApp/entities/user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#AwesomeApp/entities/user.rb</span>
</span><span class='line'><span class="k">module</span> <span class="nn">AwesomeApp</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Entities</span>
</span><span class='line'>    <span class="k">module</span> <span class="nn">User</span> <span class="o">&lt;</span> <span class="ss">Grape</span><span class="p">:</span><span class="ss">:Entity</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:id</span> <span class="c1"># always expose the id</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:name</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="p">}</span>   <span class="c1">#conditional exposure</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:email</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">][</span><span class="ss">:email</span><span class="o">]</span><span class="p">}</span> <span class="c1">#conditional exposure</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">using</span><span class="p">:</span> <span class="ss">AwesomeApp</span><span class="p">:</span><span class="ss">:Entities</span><span class="o">::</span><span class="no">Post</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;user&quot;</span><span class="o">][</span><span class="ss">:posts</span><span class="o">]</span><span class="p">}</span> <span class="c1"># present user&#39;s posts</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#AwesomeApp/Entities/post.rb</span>
</span><span class='line'><span class="k">module</span> <span class="nn">AwesomeApp</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Entities</span>
</span><span class='line'>    <span class="k">module</span> <span class="nn">Post</span> <span class="o">&lt;</span> <span class="ss">Grape</span><span class="p">:</span><span class="ss">:Entity</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:id</span> <span class="c1"># always expose the id</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:title</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;post&quot;</span><span class="o">][</span><span class="ss">:name</span><span class="o">]</span><span class="p">}</span>   <span class="c1">#conditional exposure</span>
</span><span class='line'>      <span class="n">expose</span> <span class="ss">:content</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="nb">lambda</span><span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="p">,</span><span class="n">options</span><span class="o">|</span> <span class="n">options</span><span class="o">[</span><span class="ss">:entity_options</span><span class="o">][</span><span class="s2">&quot;post&quot;</span><span class="o">][</span><span class="ss">:email</span><span class="o">]</span><span class="p">}</span> <span class="c1">#conditional exposure</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Without changing anything to the api, you can now call</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">GET</span> <span class="s1">&#39;/users/123&#39;</span><span class="p">,</span> <span class="n">entity_options</span><span class="p">:</span> <span class="p">{</span> <span class="ss">user</span><span class="p">:</span> <span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">posts</span><span class="p">:</span> <span class="kp">true</span><span class="p">},</span> <span class="ss">post</span><span class="p">:</span> <span class="p">{</span><span class="ss">title</span><span class="p">:</span> <span class="kp">true</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To tell the api you want to include the user&rsquo;s post ids in the response. You will then get something that looks like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nb">id</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
</span><span class='line'>  <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">posts</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>    <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">456</span><span class="p">,</span> <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;first post&quot;</span> <span class="p">},</span> <span class="c1">#post content is not asked for, therefore not sent</span>
</span><span class='line'>    <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="mi">789</span><span class="p">,</span> <span class="ss">title</span><span class="p">:</span> <span class="s2">&quot;second post&quot;</span> <span class="p">},</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">A. Hervé</span></span>

      








  


<time datetime="2014-10-14T09:52:35+02:00" pubdate data-updated="true">Oct 14<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/api/'>api</a>, <a class='category' href='/blog/categories/grape/'>grape</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://aurelien-herve.com/blog/2014/10/14/advanced-api-option-parser-for-grape/" data-via="aurel_herve" data-counturl="http://aurelien-herve.com/blog/2014/10/14/advanced-api-option-parser-for-grape/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2014/05/23/how-to-migrate-your-django-users-to-a-new-rails-application/" title="Previous Post:
        how to migrate your django users to a new rails application">&laquo; how to migrate your django users to a new rails application</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/2015/01/14/big-data-with-hadoop-stream-and-ruby/"
        title="Next Post: Big data with hadoop stream and ruby (and not even one line of java)">Big data with hadoop stream and ruby (and not even one line of java)
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2015/01/21/awesome-low-level-caching-for-your-rails-app/">Awesome low level caching for your Rails app</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/16/building-a-recommendation-engine-with-ruby/">Writing a recommendation engine with ruby and mongoid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/14/big-data-with-hadoop-stream-and-ruby/">Big data with hadoop stream and ruby (and not even one line of java)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/14/advanced-api-option-parser-for-grape/">Building an advanced api option parser for grape</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/23/how-to-migrate-your-django-users-to-a-new-rails-application/">how to migrate your django users to a new rails application</a>
      </li>
    
  </ul>
</section>

<section class="well">
  <ul id="gh_repos" class="nav">
    <li class="nav-header">GitHub Repos</li>
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/aherve">@aherve</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        github.showRepos({
            user: 'aherve',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/asides/github.js" type="text/javascript"> </script>
</section>

<a class="twitter-timeline" href="https://twitter.com/aurel_herve" data-widget-id="439334447087747072">Tweets by @aurel_herve</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2015 - A. Hervé -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'aherve';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://aurelien-herve.com/blog/2014/10/14/advanced-api-option-parser-for-grape/';
        var disqus_url = 'http://aurelien-herve.com/blog/2014/10/14/advanced-api-option-parser-for-grape/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
